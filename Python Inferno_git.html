<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Inferno: Stable Edition</title>
    <style>
        :root {
            --bg-color: #1e1e1e;
            --card-bg: #252526;
            --accent: #007acc;
            --text-main: #d4d4d4;
            --inferno: #ff4757;
            --success: #2ecc71;
        }

        body {
            font-family: 'Segoe UI', 'Consolas', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        h1 {
            margin-bottom: 5px;
            color: var(--accent);
        }

        .subtitle {
            font-size: 0.9em;
            opacity: 0.7;
            margin-bottom: 25px;
            font-family: 'Consolas', monospace;
        }

        /* WRAPPERS */
        .hud,
        .game-container,
        .forge-container {
            width: 100%;
            max-width: 800px;
            background: var(--card-bg);
            border: 1px solid #333;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }

        /* HUD */
        .hud {
            display: flex;
            justify-content: space-between;
            padding: 15px;
        }

        .stat-box {
            text-align: center;
        }

        .stat-label {
            font-size: 0.7em;
            color: #888;
            letter-spacing: 1px;
        }

        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
            font-family: 'Consolas', monospace;
        }

        /* GAME AREA */
        .game-container {
            padding: 20px;
        }

        /* Navigation */
        .nav-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .nav-btn {
            background: #333;
            color: #ddd;
            border: 1px solid #444;
            padding: 5px 15px;
            cursor: pointer;
            border-radius: 4px;
        }

        .nav-btn:hover:not(:disabled) {
            border-color: var(--accent);
            background: #444;
        }

        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* CODE DISPLAY (Question) */
        .code-window {
            background: #1e1e1e;
            border: 1px solid #444;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 20px;
            position: relative;
        }

        .code-window::before {
            content: "question.py";
            position: absolute;
            top: -10px;
            left: 10px;
            background: var(--accent);
            color: white;
            padding: 2px 8px;
            font-size: 0.75em;
            border-radius: 4px;
        }

        pre {
            margin: 0;
            font-family: 'Consolas', monospace;
            font-size: 1.1em;
            white-space: pre-wrap;
            line-height: 1.5;
        }

        /* BUTTONS */
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            background: #2d2d2d;
            border: 1px solid #444;
            color: #ccc;
            padding: 15px;
            cursor: pointer;
            font-family: 'Consolas', monospace;
            font-size: 1em;
            border-radius: 6px;
            text-align: left;
            transition: 0.2s;
        }

        .btn:hover:not(:disabled) {
            background: #383838;
            border-color: var(--accent);
        }

        .btn.correct {
            background: #1b472a;
            border-color: var(--success);
            color: white;
        }

        .btn.wrong {
            background: #581b23;
            border-color: var(--inferno);
            color: white;
        }

        /* HINT */
        .hint-section {
            margin-top: 15px;
            text-align: center;
        }

        .hint-text {
            display: none;
            color: #dcdcaa;
            font-style: italic;
            margin-top: 5px;
        }

        .hint-btn {
            background: none;
            border: none;
            color: #666;
            text-decoration: underline;
            cursor: pointer;
        }

        /* --- THE FORGE (IDE) --- */
        .forge-header {
            padding: 8px 15px;
            background: #333;
            color: #888;
            font-size: 0.85em;
            border-bottom: 1px solid #444;
            border-radius: 8px 8px 0 0;
        }

        .ide-wrapper {
            position: relative;
            height: 250px;
            background: #1e1e1e;
            border-radius: 0 0 8px 8px;
            overflow: hidden;
            /* Contains the absolute elements */
        }

        .ide-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 15px;
            box-sizing: border-box;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre;
            overflow: auto;
            border: none;
            outline: none;
            tab-size: 4;
        }

        /* The formatting layer (Bottom) */
        pre.ide-layer {
            z-index: 5;
            pointer-events: none;
            /* Let clicks pass through to textarea */
            margin: 0;
        }

        /* The typing layer (Top) */
        textarea.ide-layer {
            z-index: 10;
            color: transparent;
            /* Text is invisible so we see the layer below */
            background: transparent;
            caret-color: white;
            /* Cursor remains visible */
            resize: none;
        }

        /* SYNTAX COLORS */
        .kw {
            color: #569cd6;
            font-weight: bold;
        }

        /* Keywords */
        .fn {
            color: #dcdcaa;
        }

        /* Functions */
        .str {
            color: #ce9178;
        }

        /* Strings */
        .num {
            color: #b5cea8;
        }

        /* Numbers */
        .cmt {
            color: #6a9955;
            font-style: italic;
        }

        /* Comments */
    </style>
</head>

<body>

    <h1>PYTHON INFERNO</h1>
    <div class="subtitle">v3.1 // Stable Edition</div>

    <div class="hud">
        <div class="stat-box">
            <div class="stat-label">SCORE</div>
            <div class="stat-value" id="score">0</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">DIFFICULTY</div>
            <div class="stat-value" id="lvl-display">NORMAL</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">STREAK</div>
            <div class="stat-value" id="streak">0</div>
        </div>
    </div>

    <div class="game-container">
        <div class="nav-bar">
            <button class="nav-btn" id="btn-prev" onclick="navigate(-1)">← Prev</button>
            <span style="font-family:'Consolas',monospace; color:#888" id="prog-display">Loading...</span>
            <button class="nav-btn" id="btn-next" onclick="navigate(1)">Skip →</button>
        </div>

        <div class="code-window">
            <pre id="code-block"></pre>
        </div>

        <div class="controls" id="options-area"></div>

        <div class="hint-section">
            <button class="hint-btn" id="hint-trigger" onclick="showHint()">Show Hint (-5 pts)</button>
            <div class="hint-text" id="hint-display"></div>
        </div>
    </div>

    <div class="forge-container">
        <div class="forge-header">THE FORGE (Scratchpad)</div>
        <div class="ide-wrapper">
            <pre class="ide-layer" id="highlight-layer"></pre>
            <textarea class="ide-layer" id="input-layer" spellcheck="false"
                placeholder="# Type your Python code here...&#10;# It will auto-highlight." oninput="handleInput()"
                onkeydown="handleTab(event)" onscroll="syncScroll()"></textarea>
        </div>
    </div>

    <script>
        // --- MASTER DATABASE: 40 QUESTIONS ---
        const db = [
            // ==========================================
            // LEVEL 1: NORMAL (Warm Up)
            // ==========================================
            {
                level: "Normal",
                code: "x = 'Python'\nprint(x[1:4])",
                options: ["Pyt", "yth", "ytho", "Pyth"],
                answer: 1,
                hint: "Slicing is [start:stop]. Index 1 is 'y'. It stops BEFORE index 4 ('o').",
                userChoice: null
            },
            {
                level: "Normal",
                code: "def add(a, b):\n    return a + b\n\nprint(add(10, '20'))",
                options: ["30", "1020", "Error", "None"],
                answer: 2,
                hint: "Python is strongly typed. You cannot mathematically add an int (10) to a str ('20').",
                userChoice: null
            },
            {
                level: "Normal",
                code: "print(bool([]) or bool(0) or bool(' '))",
                options: ["True", "False", "Error", "None"],
                answer: 0,
                hint: "Empty lists and 0 are False. A string with a space ' ' is not empty, so it is True.",
                userChoice: null
            },
            {
                level: "Normal",
                code: "x = [1, 2, 3]\nx.append([4, 5])\nprint(len(x))",
                options: ["5", "4", "3", "Error"],
                answer: 1,
                hint: "append() adds a SINGLE element. The list becomes [1, 2, 3, [4, 5]]. Length is 4.",
                userChoice: null
            },
            {
                level: "Normal",
                code: "name = 'Alice'\nprint(f'{name:*^10}')",
                options: ["Alice*****", "**Alice***", "Alice", "*****Alice"],
                answer: 1,
                hint: "The format specifier ^10 centers the text in 10 spaces. The * fills the empty space.",
                userChoice: null
            },
            {
                level: "Normal",
                code: "x = 10\ny = 5\nprint(x // y)",
                options: ["2.0", "2", "50", "Error"],
                answer: 1,
                hint: "The // operator is 'floor division'. It discards the decimal, returning an integer.",
                userChoice: null
            },
            {
                level: "Normal",
                code: "a = {1, 2, 2, 3}\nprint(len(a))",
                options: ["4", "3", "2", "Error"],
                answer: 1,
                hint: "Curly braces {} create a Set. Sets automatically remove duplicate values.",
                userChoice: null
            },
            {
                level: "Normal",
                code: "print('apple'.replace('p', 'b', 1))",
                options: ["abble", "abple", "apple", "Error"],
                answer: 1,
                hint: "The third argument (1) limits the replacement to the first occurrence only.",
                userChoice: null
            },

            // ==========================================
            // LEVEL 2: CHALLENGING (The Climb)
            // ==========================================
            {
                level: "Challenging",
                code: "d = {'a': 1, 'b': 2}\nprint(d.get('c', 3))",
                options: ["None", "Error", "3", "1"],
                answer: 2,
                hint: "d.get(key, default) returns the default value (3) if the key ('c') is missing.",
                userChoice: null
            },
            {
                level: "Challenging",
                code: "x = [1, 2, 3]\ny = x\ny.append(4)\nprint(x)",
                options: ["[1, 2, 3]", "[1, 2, 3, 4]", "Error", "None"],
                answer: 1,
                hint: "Assignments in Python copy the REFERENCE, not the data. x and y point to the same list.",
                userChoice: null
            },
            {
                level: "Challenging",
                code: "print(3 * '7')",
                options: ["21", "777", "Error", "37"],
                answer: 1,
                hint: "Multiplying a string repeats it. '7' repeated 3 times is '777'.",
                userChoice: null
            },
            {
                level: "Challenging",
                code: "a = [1, 2, 3]\ndel a[:]\nprint(a)",
                options: ["None", "[]", "Error", "[1, 2, 3]"],
                answer: 1,
                hint: "Deleting a slice [:] clears the contents of the list but keeps the list object alive.",
                userChoice: null
            },
            {
                level: "Challenging",
                code: "def func(x=[]):\n    pass\n\nprint(func())",
                options: ["[]", "None", "Error", "Pass"],
                answer: 1,
                hint: "If a function doesn't explicitly return a value, it returns None by default.",
                userChoice: null
            },
            {
                level: "Challenging",
                code: "x = True\ny = False\nprint(x or y and False)",
                options: ["True", "False", "Error", "None"],
                answer: 0,
                hint: "'and' has higher precedence than 'or'. Evaluates as: True or (False and False).",
                userChoice: null
            },
            {
                level: "Challenging",
                code: "nums = [1, 2, 3]\nnums[1] = [4, 5]\nprint(len(nums))",
                options: ["3", "4", "5", "Error"],
                answer: 0,
                hint: "You replaced ONE element (index 1) with a list. The list length is still 3.",
                userChoice: null
            },
            {
                level: "Challenging",
                code: "x = (1)\nprint(type(x))",
                options: ["tuple", "int", "list", "Error"],
                answer: 1,
                hint: "A tuple with one item needs a trailing comma (1,). Without it, it's just a math parentheses.",
                userChoice: null
            },

            // ==========================================
            // LEVEL 3: INTENSE (Sweating)
            // ==========================================
            {
                level: "Intense",
                code: "res = [x for x in range(3) if x % 2 == 0]\nprint(res)",
                options: ["[0, 2]", "[0, 1, 2]", "[2]", "[1]"],
                answer: 0,
                hint: "Range(3) yields 0, 1, 2. 0%2 is 0 (True). 1%2 is 1 (False). 2%2 is 0 (True).",
                userChoice: null
            },
            {
                level: "Intense",
                code: "def func(a, *args, b):\n    return b\n\nprint(func(1, 2, 3, b=4))",
                options: ["4", "3", "Error", "None"],
                answer: 0,
                hint: "*args absorbs extra positional arguments (2, 3). 'b' must be named explicitly.",
                userChoice: null
            },
            {
                level: "Intense",
                code: "print(all([]))",
                options: ["True", "False", "Error", "None"],
                answer: 0,
                hint: "The all() function returns True if the iterable is empty (vacuously true).",
                userChoice: null
            },
            {
                level: "Intense",
                code: "x = {1, 2, 3}\nx.add(2)\nx.add(2)\nprint(len(x))",
                options: ["5", "4", "3", "Error"],
                answer: 2,
                hint: "Sets only store unique elements. Adding 2 again does nothing.",
                userChoice: null
            },
            {
                level: "Intense",
                code: "a = [1, 2]\nb = a\na = [3, 4]\nprint(b)",
                options: ["[1, 2]", "[3, 4]", "Error", "None"],
                answer: 0,
                hint: "Assigning 'a = [3, 4]' creates a NEW list. 'b' is still pointing to the OLD list.",
                userChoice: null
            },
            {
                level: "Intense",
                code: "i = 1\nwhile i < 5:\n    if i == 3:\n        break\n    i += 1\nelse:\n    i = 99\nprint(i)",
                options: ["99", "5", "3", "4"],
                answer: 2,
                hint: "The 'else' block of a loop ONLY runs if the loop finishes naturally (no break).",
                userChoice: null
            },
            {
                level: "Intense",
                code: "x = lambda a, b: a if a > b else b\nprint(x(10, 5))",
                options: ["5", "10", "True", "False"],
                answer: 1,
                hint: "This is a lambda with a ternary operator. It returns the max of the two numbers.",
                userChoice: null
            },
            {
                level: "Intense",
                code: "keys = ['a', 'b', 'c']\nvals = [1, 2]\nd = dict(zip(keys, vals))\nprint(len(d))",
                options: ["3", "2", "Error", "0"],
                answer: 1,
                hint: "zip() stops at the shortest list. 'c' is ignored.",
                userChoice: null
            },

            // ==========================================
            // LEVEL 4: RIDICULOUS (Mental Fatigue)
            // ==========================================
            {
                level: "Ridiculous",
                code: "x = (1, 2, [3])\nx[2].append(4)\nprint(x)",
                options: ["(1, 2, [3, 4])", "Error", "(1, 2, [3])", "Immutable Error"],
                answer: 0,
                hint: "Tuples are immutable, but they store references. The LIST inside is still mutable.",
                userChoice: null
            },
            {
                level: "Ridiculous",
                code: "def gen():\n    yield 1\n    return 2\n\ng = gen()\nprint(next(g))",
                options: ["1", "2", "Error", "None"],
                answer: 0,
                hint: "The first next() hits the yield. The return value is only seen in the StopIteration exception.",
                userChoice: null
            },
            {
                level: "Ridiculous",
                code: "class A:\n    x = 1\n\na1 = A()\na2 = A()\na1.x = 2\nprint(a2.x)",
                options: ["1", "2", "Error", "None"],
                answer: 0,
                hint: "a1.x = 2 creates an INSTANCE variable for a1. a2.x still looks up the CLASS variable.",
                userChoice: null
            },
            {
                level: "Ridiculous",
                code: "print(type(lambda:None))",
                options: ["<class 'function'>", "<class 'lambda'>", "<class 'NoneType'>", "Error"],
                answer: 0,
                hint: "In Python, a lambda is just a shorthand for creating a standard function object.",
                userChoice: null
            },
            {
                level: "Ridiculous",
                code: "x = 10\ndef foo():\n    print(x)\n    x = 5\n\nfoo()",
                options: ["10", "5", "Error", "None"],
                answer: 2,
                hint: "UnboundLocalError! Python sees 'x = 5' and treats 'x' as local, so print(x) fails before assignment.",
                userChoice: null
            },
            {
                level: "Ridiculous",
                code: "a = [10, 20]\nb = a[:]\nprint(a is b, a == b)",
                options: ["True True", "False True", "True False", "False False"],
                answer: 1,
                hint: "'is' checks identity (memory address). '==' checks value. Slicing creates a NEW copy.",
                userChoice: null
            },
            {
                level: "Ridiculous",
                code: "try:\n    raise Exception\nexcept BaseException:\n    print('A')\nexcept Exception:\n    print('B')",
                options: ["A", "B", "A B", "Error"],
                answer: 0,
                hint: "BaseException is the parent of Exception. It catches it first.",
                userChoice: null
            },
            {
                level: "Ridiculous",
                code: "x = True\nprint(isinstance(x, int))",
                options: ["True", "False", "Error", "None"],
                answer: 0,
                hint: "In Python, Booleans are a subclass of Integers (True is 1, False is 0).",
                userChoice: null
            },

            // ==========================================
            // LEVEL 5: INFERNO (Pure Evil)
            // ==========================================
            {
                level: "Inferno",
                code: "def extend(val, t=[]):\n    t.append(val)\n    return t\n\nl1 = extend(10)\nl2 = extend(123, [])\nl3 = extend('a')\n\nprint(l1)",
                options: ["[10]", "[10, 'a']", "[10, 123, 'a']", "Error"],
                answer: 1,
                hint: "Mutable Default Argument trap! l1 and l3 share the SAME default list object in memory.",
                userChoice: null
            },
            {
                level: "Inferno",
                code: "f = [lambda: i for i in range(3)]\nprint(f[0]())",
                options: ["0", "2", "None", "Error"],
                answer: 1,
                hint: "Late Binding Closure! The lambda looks up 'i' when CALLED, not when defined. Loop is done, i=2.",
                userChoice: null
            },
            {
                level: "Inferno",
                code: "a = 256\nb = 256\nc = 257\nd = 257\nprint(a is b, c is d)",
                options: ["True True", "True False", "False True", "False False"],
                answer: 1,
                hint: "Python 'interns' small integers (-5 to 256). They share memory. Larger ints usually don't.",
                userChoice: null
            },
            {
                level: "Inferno",
                code: "x = [[]] * 3\nx[0].append(1)\nprint(x)",
                options: ["[[1], [], []]", "[[1], [1], [1]]", "[[1]]", "Error"],
                answer: 1,
                hint: "Using * on a list containing mutable objects duplicates the REFERENCES. All 3 items are the same list.",
                userChoice: null
            },
            {
                level: "Inferno",
                code: "class A: pass\nclass B(A): pass\nclass C(A): pass\nclass D(B, C): pass\nprint(D.mro())",
                options: ["D, B, C, A", "D, C, B, A", "D, A, B, C", "Error"],
                answer: 0,
                hint: "Method Resolution Order (C3 Linearization). D -> B -> C -> A.",
                userChoice: null
            },
            {
                level: "Inferno",
                code: "d = {True: 'yes', 1: 'no', 1.0: 'maybe'}\nprint(d)",
                options: ["{True:'yes', 1:'no', 1.0:'maybe'}", "{True:'maybe'}", "{1.0:'maybe'}", "Error"],
                answer: 2,
                hint: "True, 1, and 1.0 all have the same hash and are equal. They overwrite each other. The KEY remains the first one (True or 1), value updates.",
                userChoice: null
            },
            {
                level: "Inferno",
                code: "def f(x):\n    return x\n\nprint(f(x=1, x=2))",
                options: ["1", "2", "Error", "None"],
                answer: 2,
                hint: "SyntaxError! You cannot pass the same keyword argument twice.",
                userChoice: null
            },
            {
                level: "Inferno",
                code: "nan = float('nan')\nprint(nan == nan)",
                options: ["True", "False", "Error", "None"],
                answer: 1,
                hint: "By definition, IEEE 754 floating point NaN is not equal to anything, including itself.",
                userChoice: null
            }
        ];

        // --- LOGIC ENGINE ---
        let qIdx = 0;
        let score = 0;
        let streak = 0;

        const els = {
            code: document.getElementById('code-block'),
            opts: document.getElementById('options-area'),
            score: document.getElementById('score'),
            streak: document.getElementById('streak'),
            lvl: document.getElementById('lvl-display'),
            hintBtn: document.getElementById('hint-trigger'),
            hintTxt: document.getElementById('hint-display'),
            prog: document.getElementById('prog-display'),
            prev: document.getElementById('btn-prev'),
            next: document.getElementById('btn-next'),
            input: document.getElementById('input-layer'),
            high: document.getElementById('highlight-layer')
        };

        // 1. HIGHLIGHTER ENGINE (REGEX)
        function highlight(code) {
            // Escape HTML
            let text = code.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");

            // Define Patterns (Order matters!)
            // Strings
            text = text.replace(/(".*?"|'.*?')/g, '<span class="str">$1</span>');
            // Comments
            text = text.replace(/(#.*)/g, '<span class="cmt">$1</span>');
            // Keywords
            const kws = ["def", "class", "return", "if", "else", "elif", "for", "while", "in", "import", "from", "print", "try", "except", "lambda", "yield", "None", "True", "False"];
            // We use a regex constructor to match whole words only (\b)
            kws.forEach(kw => {
                const re = new RegExp(`\\b(${kw})\\b`, 'g');
                text = text.replace(re, '<span class="kw">$1</span>');
            });
            // Numbers
            text = text.replace(/\b(\d+)\b/g, '<span class="num">$1</span>');
            // Functions (naive: word followed by parenthesis)
            text = text.replace(/\b([a-zA-Z_]\w*)\s*\(/g, '<span class="fn">$1</span>(');

            return text;
        }

        // 2. GAME FUNCTIONS
        function loadQuestion() {
            if (qIdx < 0) qIdx = 0;
            if (qIdx >= db.length) {
                els.code.innerHTML = "<span class='cmt'># ALL QUESTIONS COMPLETE\n# SCORE: " + score + "</span>";
                els.opts.innerHTML = "";
                return;
            }

            const q = db[qIdx];

            // Apply Highlight
            els.code.innerHTML = highlight(q.code);

            // Update UI
            els.lvl.innerText = q.level.toUpperCase();
            els.lvl.style.color = getLevelColor(q.level);
            els.prog.innerText = `${qIdx + 1} / ${db.length}`;
            els.hintTxt.innerText = q.hint;
            els.hintTxt.style.display = 'none';

            // Buttons
            els.prev.disabled = (qIdx === 0);
            els.next.innerText = (q.userChoice !== null) ? "Next →" : "Skip →";
            els.hintBtn.style.display = (q.userChoice !== null) ? 'none' : 'inline-block';

            // Render Options
            els.opts.innerHTML = '';
            q.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.innerText = opt;

                if (q.userChoice !== null) {
                    btn.disabled = true;
                    if (idx === q.answer) btn.classList.add('correct');
                    else if (idx === q.userChoice) btn.classList.add('wrong');
                } else {
                    btn.onclick = () => submitAnswer(idx);
                }
                els.opts.appendChild(btn);
            });
        }

        function submitAnswer(idx) {
            const q = db[qIdx];
            q.userChoice = idx;

            if (idx === q.answer) {
                score += 10 + (streak * 2);
                streak++;
            } else {
                streak = 0;
            }
            updateStats();
            loadQuestion(); // Reloads to show locked state
        }

        function navigate(dir) {
            if (qIdx + dir >= 0 && qIdx + dir < db.length) {
                qIdx += dir;
                loadQuestion();
            }
        }

        function showHint() {
            els.hintTxt.style.display = 'block';
            score = Math.max(0, score - 5);
            updateStats();
            els.hintBtn.style.display = 'none';
        }

        function updateStats() {
            els.score.innerText = score;
            els.streak.innerText = streak;
        }

        function getLevelColor(level) {
            switch (level) {
                case 'Normal': return '#2ecc71';
                case 'Challenging': return '#f1c40f';
                case 'Intense': return '#e67e22';
                case 'Ridiculous': return '#e74c3c';
                case 'Inferno': return '#8e44ad';
                default: return '#fff';
            }
        }

        // 3. SCRATCHPAD FUNCTIONS
        function handleInput() {
            const text = els.input.value;
            els.high.innerHTML = highlight(text) + "\n"; // Add newline to sync scroll
        }

        function syncScroll() {
            els.high.scrollTop = els.input.scrollTop;
            els.high.scrollLeft = els.input.scrollLeft;
        }

        function handleTab(e) {
            if (e.key === 'Tab') {
                e.preventDefault();
                const start = els.input.selectionStart;
                const end = els.input.selectionEnd;
                els.input.value = els.input.value.substring(0, start) + "    " + els.input.value.substring(end);
                els.input.selectionStart = els.input.selectionEnd = start + 4;
                handleInput();
            }
        }

        // INIT
        try {
            loadQuestion();
        } catch (e) {
            alert("System Critical: JS Failed to Load. " + e.message);
        }
    </script>
</body>

</html>